<!DOCTYPE html>
<html lang="en">
    <head>
        <!-- If the title exists, use it, otherwise use 'W.I.N.S.T.O.N. the Robot Dog!' -->
        {% if title %}
        <title>{{ title }} - W.I.N.S.T.O.N.</title>
        {% else %}
        <title>W.I.N.S.T.O.N. the Robot Dog!</title>
        {% endif %}
        <!-- Link to stylesheets, css and tailwind -->
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta charset="UTF-8" />
        {% block meta %}
        <!-- If metadata isn't overriden, use this metadata -->
        <meta name="title" content="Winstogram" />
        <meta
            name="description"
            content="A website centered around a robot dog called W.I.N.S.T.O.N."
        />
        {% endblock %}
        <link
            rel="stylesheet"
            href="{{ url_for('static',filename='dist/css/output.css') }}"
        />
        <!-- Create hamburger menu script -->
        <script>
            // When the DOM is loaded
            document.addEventListener('DOMContentLoaded', function () {
                // When the hamburger button is clicked
                document
                    .getElementById('hamburger')
                    .addEventListener('click', () => {
                        // Toggle the active class on the navbar
                        var navbar = document.getElementById('navbar');
                        if (navbar.classList.contains('active'))
                            navbar.classList.remove('active');
                        else navbar.classList.add('active');
                        console.log('clicked');
                    });
            });
        </script>
        <!-- Import momentjs -->
        <script src="{{ url_for('static', filename='dist/lib/momentjs.js') }}"></script>
        {% block scripts %} {% endblock %}
        <style>
            /* Styles for navbar, including animation for navbar */
            @media (max-width: 768px) {
                #navbar {
                    position: relative;
                    z-index: 99;
                    transform: translatey(-100%);
                    transition: transform 0.7s ease-in-out
                }
                
                #navbar.active {
                    transform: translatey(0%);                
                }

                #bar {
                    position: relative;
                    z-index: 100;
                }

                main {
                    position: absolute;
                    top: 64px;
                }
            }
            
            .animationStopper {
                transition: none !important;
                animation: none !important;
            }

            main {
                transition: transform 0.5s ease-in-out;
            }

            </style>
    </head>

    <body class="bg-primary">
        <div class="navbar bg-secondary" id="bar">
            <!-- NAVBAR -->
            <div class="md:hidden h-16">
                <a href="/" class="inline-block w-auto">
                    <!-- Home page from logo -->
                    <!-- NOTE: Logo from https://www.flaticon.com/free-icon/robot-dog_4756845 -->
                    <img
                        class="p-5 max-h-16"
                        src="{{ url_for('static', filename='images/logo.png') }}"
                        alt="W.I.N.S.T.O.N. the Robot Dog"
                    />
                </a>
                <div id="hamburger" class="w-auto float-right">
                    <!-- Hamburger menu -->
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="w-8 py-4 mx-5 h-full float-right cursor-pointer"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="white"
                    >
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M4 6h16M4 12h16M4 18h16"
                        />
                    </svg>
                </div>
            </div>
        </div>
        <div
            class="justify-start bg-lightSecondary md:flex w-full md:bg-secondary"
            id="navbar"
        >
        <!-- The actual navbar items -->
            <a href="/">
                <img
                    class="p-5 max-h-16 hidden md:block"
                    src="{{ url_for('static', filename='images/logo.png') }}"
                    alt="W.I.N.S.T.O.N. the Robot Dog"
                />
            </a>
            <a href="/">
                <p
                    class="p-5 text-white {{ 'active' if request.path in [url_for('index'), '/'] else '' }}"
                >
                    Home
                </p>
            </a>
            <a href="{{ url_for('stream') }}">
                <p
                    class="p-5 text-white {{ 'active' if request.path == url_for('stream') else '' }}"
                >
                    Stream
                </p>
            </a>
            <a href="{{ url_for('winstogram') }}">
                <p
                    class="p-5 text-white {{ 'active' if request.path == url_for('winstogram') else '' }}"
                >
                    Winstogram
                </p>
            </a>
            <a href="{{ url_for('about') }}">
                <p
                    class="p-5 text-white {{ 'active' if request.path == url_for('about') else '' }}"
                >
                    About us
                </p>
            </a>
            {% if current_user.is_active %} {% if current_user.admin %}
            <!-- If the user is active and an admin, show the admin page -->
            <a href="{{ url_for('admin') }}">
                <p
                    class="p-5 text-white {{ 'active' if request.path == url_for('admin') else '' }}"
                >
                    Admin
                </p>
            </a>
            {% endif %}
            <div id="userDropdown" class="md:ml-auto">
                <a href="{{ url_for('user', id=current_user.id) }}">
                    <p
                        class="p-5 text-white w-3/4 inline-block md:w-auto md:text-right {{ 'active' if request.path == url_for('user', id=current_user.id) else '' }}"
                    >
                        {{ current_user.username }}
                    </p>
                </a>
                <form
                    method="post"
                    action="{{ url_for('logout') }}"
                    novalidate
                    class="float-right border-l-2 w-1/4 border-secondary"
                >
                    <button
                        type="submit"
                        class="p-5 bg-secondary text-white md:hidden text-center w-full"
                    >
                        Logout
                    </button>
                </form>
            </div>
            {% else %}
            <a href="{{ url_for('login') }}" class="ml-auto">
                <p
                    class="p-5 text-white md:float-right {{ 'active' if request.path == url_for('login') else '' }}"
                >
                    Login
                </p>
            </a>
            {% endif %}
        </div>
        <div class="w-full flex absolute">
            <!-- User dropdown content for logout button -->
            <div
                id="userDropdownContent"
                class="bg-lightSecondary ml-auto hidden"
            >
                <form method="post" action="{{ url_for('logout') }}" novalidate>
                    <button typ="submit" class="py-2 px-5 text-white">
                        Logout
                    </button>
                </form>
            </div>
        </div>

        <!-- Main content with padding to ensure no custom padding will be needed per page -->
        <main class="w-full">
            <div class="px-10 py-5 max-h-[calc(100%-64px)] w-full">
                <!-- Show flashed messages -->
                {% with messages = get_flashed_messages() %} {% if messages %}
                <ul>
                    {% for message in messages %}
                    <li class="text-3xl">{{ message }}</li>
                    {% endfor %}
                </ul>
                {% endif %} {% endwith %}
                <br />
                <!-- Main content -->
                {% block content %}{% endblock %}
            </div>
        </main>

        <script>
            // For user dropdown content on full screen mode, if hovering over the dropdown content, keep it open
            // On mouse leave, close it
            document.addEventListener('DOMContentLoaded', () => {
                const dropdownContent = document.getElementById(
                    'userDropdownContent'
                );
                const dropdown = document.getElementById('userDropdown');

                dropdown?.addEventListener('mouseenter', () => {
                    dropdownContent.classList.add('md:block');
                });
                dropdownContent?.addEventListener('mouseenter', () => {
                    dropdownContent.classList.add('md:block');
                });
                dropdown?.addEventListener('mouseleave', () => {
                    dropdownContent.classList.remove('md:block');
                });
                dropdownContent?.addEventListener('mouseleave', () => {
                    dropdownContent.classList.remove('md:block');
                });
            });
        </script>
    </body>
</html>
